---
title: "Introducción al análisis de secuencias NGS"
subtitle: 'Curso Genética y Genómica en Producción Animal'
author:
 name: Dr. José A. Gallardo, Dr(c) Margarita Rivera.
 affiliation: Pontificia Universidad Católica de Valparaíso
 email: <jose.gallardo@pucv.cl>
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    code_folding: hide
  word_document: default
  pdf_document: default
---

<style>
#TOC {
  color: black;
  font-familiy: Calibri;
  font-size: 14px;
  border-color: #708090; 
}
body {
   color: black;
   font-familiy: Calibri;
}

pre {
  color: black;
  background-color: #F8F8FF;
}
# header {
  color: #800000;
  font-familiy: Calibri;
  background-color: #F5F5F5;
  opacity: 0.8;
  font-size: 16px;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

## INTRODUCCIÓN

Las tecnologías de secuenciación de próxima generación han evolucionado significativamente para proporcionar una mayor producción de datos (Taishan, Chitnis, Monos, & Dinh, 2021). Sin embargo, las plataformas son susceptibles a una amplia gama de fallas químicas e instrumentales (Stephan et al., 2014), por lo que, los datos obtenidos pueden tener un fuerte ruido de fondo, contaminación de los adaptadores, baja calidad de secuenciación, entre otros (He et al., 2020), lo que posteriormente representa problemas significativos en la precisión de la detección de variantes o regiones genómicas objetos de estudio. Por ello, el control de calidad, en el preprocesamiento de datos, se torna esencial, a fin de contar con datos limpios para evitar errores en análisis posteriores.

Para efectuar el control de calidad se han desarrollado herramientas bioinformáticas como FastQC (Andrews, 2020), un software compatible con todas las principales plataformas de secuenciación. El Presente trabajo tiene como objetivo,realizar un análisis integral de control de calidad de secuencias NGS. Con fin ocuparemos el software **FastQC** y lecturas crudas obtenidas por secuenciación de extremos emparejados con Illumina HiSeq2000 de la cepa Aquagen de _Salmo salar_, a partir de un estudio de resistencia a la necrosis pancreática infecciosa.

### FORMATO FASTQ

![Estructura archivo fastq](https://user-images.githubusercontent.com/80792310/120213418-ca98e500-c1f8-11eb-853b-0d36019e87ac.png)


El archivo fastq contiene las lecturas de secuenciación. Como se nota en la Figura 1, una lectura de secuenciación tiene 4 líneas, la primera representa el encabezado de la lectura, que inicia siempre con un @ y contiene datos informativos como, el número de serie del secuenciador y de carril, el swath que representa una región dentro del carril, las posiciones x e y dentro de cada swath y la dirección de las lecturas indicando una secuenciación pareada en este caso. 

Después del encabezado se tiene la secuencia de bases, el signo más y, las calidades, donde hay una correspondencia entre la base y su valor de calidad representado por un caracter alfanumérico ya sean números o letras codificados para un determinado Phred score.

Las secuencias deben tener sobre un QFRED mayor a 30

Quality score     0 ... 10 ... 20 ... 30
Quality enconding ! ... +  ... 5  ... A

## SOFTWARE DE BIOINFORMÁTICA PARA ANÁLISIS DE SECUENCIAS FASTQ Y CONTROL DE CALIDAD

## **FastQC**

**Descripción**

[fastqc](http://www.bioinformatics.babraham.ac.uk/projects/fastqc/) es un software que permite realizar análisis de control de calidad de secuencias NGS.
uno de los softwares más empleados para análisis de calidad, siendo compatible con todas las principales plataformas de secuenciación (Andrews, 2010). Se puede tener más información en la página del software: <https://www.bioinformatics.babraham.ac.uk/projects/fastqc/>

La versión del FastQC empleada en este trabajo es la 0.11.8. Este software tiene como objetivo proporcionar un conjunto modular de análisis para conocer si los datos tienen algún problema que deba tener en cuenta antes de realizar un análisis adicional.  FastQC resume la calidad de lectura por posición, informa al usuario del contenido del adaptador en secuencias, sobre frecuencias de tetrámeros y muchos otros aspectos que uno esperaría obtener de los datos de secuencia sin procesar (Brown, Pirrung, & McCue, 2017).

## **Trimmomatic**

**Descripción**
[Trimmomatic](http://www.usadellab.org/cms/?page=trimmomatic) es un software que permite filtrar y podar datos NGS desde secuenciadores Illumina. 

Es una herramienta de línea de comandos rápida y multiproceso que se puede utilizar para filtrar y recortar datos de Illumina (FASTQ), así como para eliminar adaptadores. Trabaja con archivos FASTQ utilizando puntuaciones de calidad phred + 33 o + 64, dependiendo de la tubería de Illumina utilizada (Bolger, Lohse & Usadel, 2014). 

Un manual del uso del software se puede descargar [aquí](http://www.usadellab.org/cms/uploads/supplementary/Trimmomatic/TrimmomaticManual_V0.32.pdf)

## Objetivos del trabajo práctico

- Realizar un análisis integral de control de calidad de secuencias NGS con fastqc. 

- Filtrar y podar las secuencias con el software trimmomatic

## PRÁCTICA UNIDAD 3 - SUBTÓPICO 2.2: ANÁLISIS DE DATOS DE SECUENCIACIÓN MASIVA (NGS)

Etapas
- Descargar secuencias NGS usando SRA toolkit.
- Comprobar integridad de descarga de archivos usando md5sum o similar.
- Realizar análisis de control de calidad.
- Realizar filtrado y poda de secuencias.
- Transferir archivos de control de calidad mediante protocolo FTP desde Servidor a Cliente.


## 1 - CONECTAR A SERVIDOR POMEO

Conecte al servidor pomeo usando la siguiente dirección IP: **200.54.220.141** puerto 22.

Ese el software PuTTy y las claves de acceso dadas en la clase anterior.

## 2 - CONFIGURAR BIOCONDA E INSTALAR SOFTWARES PARA ANÁLISIS

Para configurar el canal bioconda se debe ejecutar el siguiente comando

    conda config --add channels bioconda
    
Para la instalación de los software proceda a ejecutar los siguientes comandos en la terminal:

    conda install -c bioconda fastqc

    conda install -c bioconda trimmomatic

Revise si estan correctamente instalados usando el siguiente comando

    conda search -c bioconda fastqc
    
    conda search -c bioconda trimmomatic

Usando el comando **mkdir** cree un directorio llamado SRA_samples

    mkdir SRA_samples

Acceda a este directorio con el comando 

    cd SRA_samples 



## 3 - DESCARGA DE SECUENCIAS SRA

Para esta práctica se trabajará con las siguientes biomuestras

Biomuestra 1:SRR2006763_1.fastq
Biomuestra 2:SRR2006763_2.fastq

Crear un archivo ejecutable (.sh) con nano que se denominará con las iniciales de su nombre y su número de alumno correspondiente e.g.

    nano mr01.sh

Introducir y guardar la información del script como se detalla a continuación, cambiando la segunda línea que representa el nombre de su trabajo, por fastqc y su número de alumno e.g "fastqc01"

     #!/bin/bash
     #SBATCH -J fastqc01
     #SBATCH --nodes=1           # Numero de nodos
     #SBATCH --ntasks-per-node=1 # Numero de cores
     #SBATCH --time=00:30        # Duración (D-HH:MM)
    /home2/usuario/sratoolkit.2.11.0-centos_linux64/bin/prefetch --max-size 100G SRR2006763 -O /home2/usuario/SRA_samples/

Este script contiene las instrucciones necesarias para la descarga de la secuencia con el comando Prefetch que es parte del kit de herramientas de SRA y su función es descargar archivos de secuencia en formato SRA comprimido. La descarga demorará alrededor de dos minutos


Correr el script mediante el siguiente comando

     bash mr01.sh

Al finalizar la ejecución listar la carpeta

    ls -l -h SRA_samples

Verificar la salida generada con el nombre

     SRR2006763

## 4- COMPROBACIÓN DE INTEGRIDAD DE ARCHIVO

a) Busque el código Md5 de las muestras en NCBI.

Biomuestra 1: 

b) Compruebe la integridad de ambas biomuestras usando md5sum o similar.


## 5 - ANÁLISIS DE CONTROL DE CALIDAD

- Análisis de control de calidad de secuencias fastq que provienen de secuenciadores NGS

1. entrega archivo HTML
2. entrega archivo .zip


- Transferir archivos mediante protocolo FTP desde Servidor a Cliente


## 6 - FILTRADO Y PODA


## REFERENCIAS

Grüning, B., Dale, R., Sjödin, A. et al. Bioconda: sustainable and comprehensive software distribution for the life sciences. Nat Methods 15, 475–476 (2018). https://doi.org/10.1038/s41592-018-0046-7 
Brown, J., Pirrung, M., & McCue, L. (2017). FQC Dashboard: integrates FastQC results into a web-based, interactive, and extensible FASTQ quality control tool. Bioinformatics, 3137–3139.
Stephan, P., Dander, A., Fischer, M., Snajder, R., Sperk, M., Efremova, M., . . . Trajanoski, Z. (2014). A survey of tools for variant analysis of next-generation genome sequencing data. Briefings in Bioinformatics, 256-278.
Taishan, H., Chitnis, N., Monos, D., & Dinh, A. (2021). Next-generation sequencing technologies: An overview. Human Immunology, 1-10.
He, B., Shu, R., Yang, H., Lu, Q., Wang, W., Song, L., . . . Lang, J. (2020). Assessing the Impact of Data Preprocessing on Analyzing Next Generation Sequencing . Frontiers in Bioengineering and Biotechnology, 1-12 .
Bolger AM, Lohse M, Usadel B. Trimmomatic: a flexible trimmer for Illumina sequence data. Bioinformatics. 2014;30(15):2114-2120. doi:10.1093/bioinformatics/btu170
